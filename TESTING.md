# 🧪 前后端联调测试指南

> 本文档指导如何测试前后端联调功能

---

## 🚀 启动项目

### 方式一：使用启动脚本（推荐）

```bash
# 双击运行
start-dev.bat
```

这将自动启动前端和后端服务。

### 方式二：手动启动

**启动后端：**
```bash
cd backend
npm run dev
```
后端将运行在：`http://localhost:5000`

**启动前端：**
```bash
cd frontend
npm run dev
```
前端将运行在：`http://localhost:3000`

---

## ✅ 测试清单

### 1️⃣ 用户注册测试

1. 访问 `http://localhost:3000/register`
2. 填写注册表单：
   - 用户名：`testuser`
   - 邮箱：`test@example.com`
   - 密码：`123456`
   - 确认密码：`123456`
3. 点击"注册"按钮
4. **预期结果：**
   - ✅ 显示"注册成功"提示
   - ✅ 自动跳转到首页
   - ✅ Header 显示用户头像和用户名
   - ✅ 显示用户菜单（后台管理、个人设置、退出登录）

### 2️⃣ 用户登录测试

1. 点击 Header 的"退出登录"
2. 访问 `http://localhost:3000/login`
3. 填写登录表单：
   - 邮箱：`test@example.com`
   - 密码：`123456`
4. 点击"登录"按钮
5. **预期结果：**
   - ✅ 显示"登录成功"提示
   - ✅ 自动跳转到首页
   - ✅ Header 显示用户信息

### 3️⃣ Token 持久化测试

1. 登录成功后，刷新页面（F5）
2. **预期结果：**
   - ✅ 用户状态保持登录
   - ✅ Header 仍显示用户信息
   - ✅ 不会跳转到登录页

### 4️⃣ 路由守卫测试

**场景 A：未登录访问后台**
1. 退出登录
2. 手动访问 `http://localhost:3000/admin`
3. **预期结果：**
   - ✅ 自动跳转到 `/login?redirect=/admin`
   - ✅ 登录成功后自动返回 `/admin`

**场景 B：已登录访问登录页**
1. 登录状态下访问 `http://localhost:3000/login`
2. **预期结果：**
   - ✅ 自动跳转到首页 `/`

### 5️⃣ Axios 拦截器测试

**请求拦截器：**
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 访问需要登录的页面（如 `/admin`）
4. 查看请求头
5. **预期结果：**
   - ✅ 请求头包含 `Authorization: Bearer <token>`

**响应拦截器（401 错误）：**
1. 打开浏览器控制台
2. 执行：`localStorage.setItem('auth_token', 'invalid_token')`
3. 刷新页面
4. **预期结果：**
   - ✅ 自动清除无效 Token
   - ✅ 自动跳转到登录页

### 6️⃣ 用户菜单测试

1. 登录后，点击 Header 的用户头像
2. **预期结果：**
   - ✅ 显示下拉菜单
   - ✅ 包含"后台管理"、"个人设置"、"退出登录"选项
3. 点击"后台管理"
   - ✅ 跳转到 `/admin`
4. 点击"退出登录"
   - ✅ 清除用户状态
   - ✅ 跳转到登录页

---

## 🛠️ 调试技巧

### 查看 Token

```javascript
// 浏览器控制台执行
localStorage.getItem('auth_token')
```

### 查看用户状态

```javascript
// 浏览器控制台执行
JSON.parse(localStorage.getItem('pinia'))
```

### 清除所有数据

```javascript
// 浏览器控制台执行
localStorage.clear()
location.reload()
```

---

## ❌ 常见问题

### 问题1：跨域错误

**症状：** 浏览器控制台显示 CORS 错误

**解决方案：**
1. 确认后端已启动
2. 检查后端 `.env` 文件中的 `CORS_ORIGIN` 设置为 `http://localhost:3000`

### 问题2：401 未授权

**症状：** API 请求返回 401 错误

**解决方案：**
1. 检查 Token 是否存在：`localStorage.getItem('auth_token')`
2. 检查 Token 是否有效（可能过期）
3. 重新登录获取新 Token

### 问题3：登录后刷新页面用户信息丢失

**症状：** 刷新页面后 userStore.user 为 null

**解决方案：**
这是正常现象，因为只保存了 Token。可以在 App.vue 初始化时调用 `fetchUserInfo()` 获取用户信息。

---

## 📊 测试结果记录

| 测试项             | 状态 | 备注 |
| ------------------ | ---- | ---- |
| 用户注册           | ✅   |      |
| 用户登录           | ✅   |      |
| Token 持久化       | ✅   |      |
| 路由守卫           | ✅   |      |
| 请求拦截器         | ✅   |      |
| 响应拦截器         | ✅   |      |
| 用户菜单           | ✅   |      |
| 登出功能           | ✅   |      |

---

## 🎯 下一步

前后端联调测试完成后，可以继续开发：

1. **博客模块**：文章列表、文章详情、文章 CRUD
2. **后台管理**：仪表盘、文章编辑器、分类/标签管理
3. **知识库模块**：文件夹管理、知识条目 CRUD

---

**测试完成时间：** 2024-12-08  
**测试人员：** Snow AI CLI  
**测试环境：** Development
